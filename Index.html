â€<!DOCTYPE html>
â€<html lang="ku" dir="rtl">
â€<head>
â€    <meta charset="UTF-8">
â€    <meta name="viewport" content="width=device-width, initial-scale=1.0">
â€    <title>Ø¨Û•Ø±Ù†Ø§Ù…Û Ø®ÙˆØ§Ù†Ø¯Ù†Ø§ Ù…Ù† (Ù¾ÛØ´Ú©Û•ÙØªÛŒ)</title>
    
â€    <!-- Firebase Libraries -->
â€    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
â€    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
â€    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

â€    <!-- Charting Libraries -->
â€    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
â€    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    
â€    <style>
â€        @import url('https://fonts.googleapis.com/css2?family=Rudaw&display=swap');

â€        :root {
â€            --bg-color: #f8fafc;
â€            --card-bg-color: #ffffff;
â€            --text-color: #0f172a;
â€            --text-color-light: #64748b;
â€            --header-bg-color: #ffffff;
â€            --border-color: #e2e8f0;
â€            --accent-color: #3b82f6;
â€            --accent-color-dark: #2563eb;
â€            --accent-color-light: #eff6ff;
â€            --progress-bar-success-color: #10b981;
â€            --button-danger-bg: #ef4444;
â€            --button-edit-bg: #f59e0b;
â€            --font-main: 'Rudaw', sans-serif;
â€            --shadow: 0 4px 12px -2px rgba(0, 0, 0, 0.08), 0 2px 8px -4px rgba(0, 0, 0, 0.05);
        }

â€        body.dark-mode {
â€            --bg-color: #020617;
â€            --card-bg-color: #0f172a;
â€            --text-color: #e2e8f0;
â€            --text-color-light: #94a3b8;
â€            --header-bg-color: #0f172a;
â€            --border-color: #1e293b;
â€            --accent-color: #60a5fa;
â€            --accent-color-dark: #3b82f6;
â€            --accent-color-light: #1e293b;
â€            --progress-bar-success-color: #34d399;
â€            --button-danger-bg: #f87171;
â€            --button-edit-bg: #fbbf24;
        }

â€        * { box-sizing: border-box; margin: 0; padding: 0; }
â€        body { font-family: var(--font-main); background-color: var(--bg-color); color: var(--text-color); transition: background-color 0.3s, color 0.3s; padding: 1rem; }
â€        .container { 
â€            width: 100%; 
â€            max-width: 800px; /*  Ù¾Ø§Ù†ÛŒÛŒÛ•Ú©Û•ÛŒ Ú©Û•Ù…Ú©Ø±Ø§ÙˆÛ•ØªÛ•ÙˆÛ• Ø¨Û† Ø´ÛÙˆØ§Ø²ÛÚ©ÛŒ ØªÛ•Ø³Ú©ØªØ± */
â€            margin: auto; 
â€            display: flex; 
â€            flex-direction: column; 
â€            gap: 1.5rem; /* Ø¨Û†Ø´Ø§ÛŒÛŒ Ù†ÛÙˆØ§Ù† Ú©Ø§Ø±ØªÛ•Ú©Ø§Ù† Ú©Û•Ù…Ú©Ø±Ø§ÙˆÛ•ØªÛ•ÙˆÛ• */
        }
â€        .card { background-color: var(--card-bg-color); border-radius: 1rem; box-shadow: var(--shadow); border: 1px solid var(--border-color); padding: 1.5rem; transition: background-color 0.3s, border-color 0.3s; }
â€        .header-card { display: flex; justify-content: space-between; align-items: center; padding: 1rem 1.5rem; }
â€        .header-title h1 { font-size: 1.75rem; } .header-title p { font-size: 0.9rem; color: var(--text-color-light); }
â€        .header-controls { display: flex; align-items: center; gap: 0.75rem; }
â€        .icon-btn { background: transparent; border: 1px solid var(--border-color); color: var(--text-color-light); width: 40px; height: 40px; border-radius: 50%; cursor: pointer; font-size: 20px; display: flex; justify-content: center; align-items: center; transition: background-color 0.2s, color 0.2s, transform 0.2s; }
â€        .icon-btn svg { width: 20px; height: 20px; stroke-width: 2; }
â€        .icon-btn:hover { background-color: var(--accent-color); color: white; transform: scale(1.1) rotate(5deg); }
â€        #theme-toggle-icon::after { content: 'â˜€ï¸'; } body.dark-mode #theme-toggle-icon::after { content: 'ğŸŒ™'; }
â€        .controls-card { display: flex; justify-content: space-between; align-items: center; }
â€        .day-navigation { display: flex; gap: 0.5rem; }
â€        .nav-btn { background-color: var(--accent-color); color: white; border: none; font-family: var(--font-main); height: 40px; padding: 0 1.25rem; border-radius: 0.5rem; cursor: pointer; font-size: 0.9rem; transition: background-color 0.2s, transform 0.2s; }
â€        .nav-btn:hover { background-color: var(--accent-color-dark); transform: translateY(-2px); }
â€        .nav-btn.arrow { width: 45px; font-size: 1.1rem; }
â€        #add-book-section { background-color: var(--accent-color-light); border-left: 5px solid var(--accent-color); transition: all 0.5s ease; overflow: hidden; }
â€        #add-book-section.hidden { max-height: 0; padding: 0 1.5rem; opacity: 0; border: none; }
â€        #add-book-section:not(.hidden) { max-height: 800px; padding: 1.5rem; opacity: 1; }
â€        #add-book-form { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
â€        #add-book-form input { padding: 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border-color); background-color: var(--card-bg-color); color: var(--text-color); font-family: var(--font-main); font-size: 0.9rem; transition: border-color 0.2s, box-shadow 0.2s; }
â€        #add-book-form input:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 0 3px var(--accent-color-light); }
â€        .form-full-width { grid-column: 1 / -1; } .day-selection { display: flex; flex-wrap: wrap; gap: 0.5rem; justify-content: center; margin-top: 0.5rem;}
â€        .day-selection label { display: flex; align-items: center; gap: 0.3rem; background-color: var(--card-bg-color); padding: 0.5rem 0.75rem; border-radius: 0.5rem; border: 1px solid var(--border-color); cursor: pointer; transition: background-color 0.2s, border-color 0.2s; font-size: 0.9rem; }
â€        .day-selection input:checked + span { color: var(--accent-color-dark); font-weight: bold; }
â€        .day-header { margin-bottom: 1.25rem; } .day-header h2 { font-size: 1.5rem; color: var(--accent-color); margin-bottom: 0.25rem; } .day-header p { font-size: 0.9rem; color: var(--text-color-light); }
â€        .progress-container { margin-bottom: 1rem; } .progress-label { display: block; margin-bottom: 0.5rem; font-size: 0.85rem; color: var(--text-color-light); }
â€        .progress { height: 10px; background-color: var(--border-color); border-radius: 5px; overflow: hidden; }
â€        .progress-bar { height: 100%; background-color: var(--accent-color); width: 0%; transition: width 0.5s ease; border-radius: 5px; }
â€        .progress-bar.success { background-color: var(--progress-bar-success-color) !important; }
â€        .tasks-table { width: 100%; border-collapse: collapse; } .tasks-table tr { border-bottom: 1px solid var(--border-color); } .tasks-table tr:last-child { border-bottom: none; }
â€        .tasks-table td { padding: 1rem 0.5rem; vertical-align: middle; }
â€        .task-container { display: flex; align-items: center; gap: 1rem; } .task-container input[type="checkbox"] { display: none; }
â€        .task-container label { cursor: pointer; display: flex; align-items: center; gap: 0.75rem; }
â€        .task-container .custom-checkbox { width: 20px; height: 20px; border: 2px solid var(--border-color); border-radius: 5px; display: flex; justify-content: center; align-items: center; transition: background-color 0.2s, border-color 0.2s; }
â€        .task-container .custom-checkbox svg { width: 14px; height: 14px; color: white; transform: scale(0); transition: transform 0.2s; }
â€        .task-container input[type="checkbox"]:checked + label .custom-checkbox { background-color: var(--accent-color); border-color: var(--accent-color); }
â€        .task-container input[type="checkbox"]:checked + label .custom-checkbox svg { transform: scale(1); }
â€        .task-subject { font-weight: bold; font-size: 0.95rem;} .task-description { color: var(--text-color-light); font-size: 0.9rem; }
â€        .task-type-badge { font-size: 0.7rem; padding: 0.2rem 0.5rem; border-radius: 0.5rem; font-weight: bold; }
â€        .task-type-badge.memorize { background-color: var(--accent-color-light); color: var(--accent-color-dark); }
â€        .task-type-badge.review { background-color: #e0f2fe; color: #075985; }
â€        #overall-progress-container, #achievements-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.25rem; }
â€        .subject-card { padding: 1.25rem; display: flex; flex-direction: column; gap: 0.75rem; }
â€        .subject-header { display: flex; justify-content: space-between; align-items: center; }
â€        .subject-label { font-weight: bold; font-size: 1rem; } .subject-controls { display: flex; gap: 0.5rem; }
â€        .subject-controls .icon-btn { width: 32px; height: 32px; background-color: var(--bg-color); }
â€        .subject-controls .icon-btn svg { width: 16px; height: 16px; }
â€        .subject-controls .icon-btn.delete:hover { background-color: var(--button-danger-bg); }
â€        .subject-controls .icon-btn.edit:hover { background-color: var(--button-edit-bg); }
â€        .progress-inputs { display: flex; align-items: center; gap: 0.5rem; font-size: 0.8rem; }
â€        .subject-card input[type="number"] { width: 55px; padding: 0.4rem; border-radius: 0.375rem; border: 1px solid var(--border-color); background-color: var(--bg-color); color: var(--text-color); text-align: center; }
â€        .subject-completion-info { font-size: 0.75rem; color: var(--text-color-light); margin-top: 0.5rem; border-top: 1px solid var(--border-color); padding-top: 0.5rem; }
â€        .timer-controls { display: flex; align-items: center; gap: 0.5rem; }
â€        .timer-btn { background-color: var(--bg-color); border: 1px solid var(--border-color); color: var(--text-color); width: 32px; height: 32px; border-radius: 50%; cursor: pointer; display: flex; justify-content: center; align-items: center; }
â€        .timer-btn svg { width: 16px; height: 16px; } .timer-btn:hover { background-color: var(--accent-color-light); }
â€        .timer-display { font-size: 0.85rem; color: var(--text-color-light); min-width: 55px; text-align: left; }
â€        #time-reports { display: flex; justify-content: space-around; text-align: center; }
â€        #time-reports div p { font-weight: bold; font-size: 1.25rem; color: var(--accent-color); }
â€        #time-reports div span { font-size: 0.85rem; color: var(--text-color-light); }
â€        .achievement-item { display: flex; align-items: center; gap: 1rem; background-color: var(--bg-color); padding: 0.75rem; border-radius: 0.5rem; }
â€        .achievement-item svg { color: var(--progress-bar-success-color); }
â€        .hidden { display: none !important; }
â€        #quote-of-the-day { text-align: center; } #quote-of-the-day blockquote { font-size: 1rem; font-style: italic; }
â€        #quote-of-the-day footer { margin-top: 0.5rem; font-size: 0.9rem; color: var(--accent-color); }
â€        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); z-index: 1000; display: flex; justify-content: center; align-items: center; transition: opacity 0.3s; }
â€        .spinner { width: 50px; height: 50px; border-radius: 50%; border: 8px solid var(--border-color); border-right-color: var(--accent-color); animation: spinner-d3gkfh 1s infinite linear; }
â€        @keyframes spinner-d3gkfh { to { transform: rotate(1turn); } }
        
â€        #contact-us-card { text-align: center; }
â€        .contact-link { display: inline-flex; align-items: center; justify-content: center; gap: 0.75rem; text-decoration: none; margin-top: 1rem; background-color: #2AABEE; color: white; padding: 0.65rem 1.25rem; border-radius: 0.5rem; font-family: var(--font-main); transition: background-color 0.2s, transform 0.2s; }
â€        .contact-link:hover { background-color: #1798D5; transform: translateY(-2px); }
â€        .contact-link svg { width: 22px; height: 22px; fill: white; }
â€    </style>
â€</head>
â€<body>
â€    <!-- Loading Spinner -->
â€    <div id="loader"><div class="spinner"></div></div>

â€    <!-- Auth Modal -->
â€    <div id="auth-modal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 999; display: flex; justify-content: center; align-items: center; padding: 1rem;">
â€        <div class="card" style="width: 100%; max-width: 400px;">
â€            <h2 id="auth-title" style="text-align: center;">Ø¯Ø§Ø®Ù„Ø¨ÙˆÙˆÙ†</h2>
â€            <form id="auth-form" style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem;">
â€                <input type="email" id="auth-email" placeholder="Ø¦ÛŒÙ…ÛÙ„" required style="font-size: 1rem;">
â€                <input type="password" id="auth-password" placeholder="Ú˜Ù…Ø§Ø±Ø§ Ù†Ù‡ÛÙ†ÛŒ" required style="font-size: 1rem;">
â€                <p id="auth-error" style="color: #ef4444; font-size: 0.9rem; text-align: center; min-height: 1.2em;"></p>
â€                <button type="submit" id="auth-submit-btn" class="nav-btn">Ø¯Ø§Ø®Ù„Ø¨ÙˆÙˆÙ†</button>
â€                <p style="text-align: center; font-size: 0.9rem;" id="auth-switch-p">
                    Ø­Ø³Ø§Ø¨Û ØªÛ• Ù†ÛŒÙ†Û•ØŸ <a href="#" id="switch-to-signup" style="color: var(--accent-color);">Ø¦ÛÚ©Û Ù†ÙˆÙˆ Ú†ÛÚ©Û•</a>
â€                </p>
â€                <a href="#" id="close-modal-btn" style="text-align: center; color: var(--text-color-light); margin-top: 0.5rem; text-decoration: none;">Ù¾Ø§Ø´Ú©Û•Ú¤ØªÙ†</a>
â€            </form>
â€        </div>
â€    </div>

â€    <div class="container" id="app-container">
        
â€        <header class="card header-card">
â€            <div class="header-title">
â€                <h1>Ø¨Û•Ø±Ù†Ø§Ù…Û Ø®ÙˆØ§Ù†Ø¯Ù†Ø§ Ù…Ù†</h1>
â€                <p id="current-date-display"></p>
â€            </div>
â€            <div class="header-controls">
â€                <button id="theme-toggle" class="icon-btn" title="Ú¯ÙˆÙ‡Ø§Ø±ØªÙ†Ø§ Ø´ÛÙˆØ§Ø²ÛŒ"><span id="theme-toggle-icon"></span></button>
â€                <button id="user-profile-btn" class="icon-btn" title="Ù¾Ø±ÙˆÙØ§ÛŒÙ„Û Ù…Ù†"></button>
â€            </div>
â€        </header>

â€        <main id="main-content">
â€            <div class="card controls-card">
â€                <div class="day-navigation">
â€                    <button id="prev-day-btn" class="nav-btn arrow" title="Ø±Û†Ú˜Ø§ Ø¨Û†Ø±ÛŒ">â†’ </button>
â€                    <button id="next-day-btn" class="nav-btn arrow" title="Ø±Û†Ú˜Ø§ Ø¨Ù‡ÛØª">â†</button>
â€                </div>
â€                <button id="toggle-add-book-btn" class="nav-btn" title="Ù¾Û•Ø±ØªÙˆÙˆÚ©Û•Ú©Ø§ Ù†ÙˆÙˆ Ø²ÛØ¯Û• Ø¨Ú©Û•">+ Ø²ÛØ¯Û•Ú©Ø±Ù†Ø§ Ù¾Û•Ø±ØªÙˆÙˆÚ©Û</button>
â€            </div>

â€            <div id="add-book-section" class="card hidden">
â€                <h2 id="form-title">Ù¾Û•Ø±ØªÙˆÙˆÚ©Û•Ú©Ø§ Ù†ÙˆÙˆ Ø²ÛØ¯Û• Ø¨Ú©Û•</h2>
â€                <form id="add-book-form">
â€                    <input type="hidden" id="editing-book-id">
â€                    <input type="text" id="new-book-name" placeholder="Ù†Ø§Ú¤Û Ù¾Û•Ø±ØªÙˆÙˆÚ©Û" required class="form-full-width">
â€                    <input type="number" id="new-book-total" placeholder="Ú©Û†Ù…Ø§ Ú¯Ø´ØªÛŒ (Ù„Ø§Ù¾Û•Ø±)" required>
â€                    <input type="number" id="new-book-weeks" placeholder="Ù…Ø§ÙˆÛ Ø¨ Ø­Û•ÙØªÛŒØ§Ù†" required>
â€                    <div class="form-full-width">
â€                        <p><strong>Ø±Û†Ú˜ÛÙ† Ú˜Ø¨Û•Ø±Ú©Ø±Ù†Û:</strong></p>
â€                        <div class="day-selection" id="memorize-days"></div>
â€                    </div>
â€                    <div class="form-full-width">
â€                        <p><strong>Ø±Û†Ú˜ÛÙ† Ù¾ÛØ¯Ø§Ú†ÙˆÙˆÙ†Û:</strong> (Ø¨Û† Ù†Ù…ÙˆÙˆÙ†Û•ØŒ Ù‡Û•Ø± Ø±Û†Ú˜Ø§ Ø¦Û•ÛŒÙ†ÛŒ Ù¾ÛØ¯Ø§Ú†ÙˆÙˆÙ† Ù„Ø³Û•Ø± ÙˆØ§Ù† Ø¨Ø§Ø¨Û•ØªØ§Ù† Ø¨Ú©Û• ÛŒÛÙ† ØªÛ• Ø¯ ÙˆÛ Ø­Û•ÙØªÛŒÛ Ø¯Ø§ Ø®ÙˆØ§Ù†Ø¯ÛŒÙ†)</p>
â€                        <div class="day-selection" id="review-days"></div>
â€                    </div>
â€                    <button type="submit" id="add-book-btn" class="nav-btn form-full-width">Ù¾Û•Ø±ØªÙˆÙˆÚ©Û Ø²ÛØ¯Û• Ø¨Ú©Û•</button>
â€                </form>
â€            </div>
            
â€            <div id="daily-schedule" class="card"></div>
            
â€            <div class="card">
â€                <h2>Ø¦Ø§Ù…Ø§Ø±ÛÙ† Ø¯Û•Ù…ÛŒ (ÛŒÛÙ† Ù†Ú¾Ø§)</h2>
â€                <div id="time-reports">
â€                    <div><p id="daily-time">00:00:00</p><span>Ø±Û†Ú˜Ø§Ù†Û•</span></div>
â€                    <div><p id="weekly-time">00:00:00</p><span>Ø­Û•ÙØªÛŒØ§Ù†Û•</span></div>
â€                    <div><p id="monthly-time">00:00:00</p><span>Ù‡Û•ÛŒÚ¤Ø§Ù†Û•</span></div>
â€                </div>
â€            </div>

â€            <div class="card">
â€                <h2>Ù¾ÛØ´Ú©Û•ÙØªÙ†Ø§ Ú¯Ø´ØªÛŒ</h2>
â€                <div id="overall-progress-container"></div>
â€            </div>
            
â€            <div id="achievements-card" class="card hidden">
â€                <h2>Ù¾Û•Ø±ØªÙˆÙˆÚ©ÛÙ† ØªÙ…Ø§Ù…Ú©Ø±ÛŒÙ†</h2>
â€                <div id="achievements-container"></div>
â€            </div>

â€            <div class="card">
â€                <h2>Ø¦Ø§Ù…Ø§Ø±ÛÙ† Ù¾ÛØ´Ú©Û•ÙØªÙ†Û</h2>
â€                <div style="height: 300px;"><canvas id="progressChart"></canvas></div>
â€            </div>
            
â€            <div id="quote-of-the-day" class="card">
â€                <blockquote id="quote-text"></blockquote>
â€                <footer id="quote-author"></footer>
â€            </div>
            
â€            <div class="card" id="contact-us-card">
â€                <h2>Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ø¨ Ù…Û• Ø¨Ú©Û•</h2>
â€                <p>Ø¨Û† Ù‡Û•Ø± Ú©ÛØ´Û•ÛŒÛ•Ú©Û ÛŒØ§Ù† Ù¾ÛØ´Ù†ÛŒØ§Ø±Û•Ú©ÛØŒ Ù„Ø³Û•Ø± ØªÛŒÙ„ÛŒÚ¯Ø±Ø§Ù…ÛŒ Ø¯Ú¯Û•Ù„ Ù…Û• Ø¨Ø§Ø®Ú¤Û•.</p>
â€                <a href="https://t.me/your_telegram_username" target="_blank" class="contact-link">
â€                    <svg viewBox="0 0 24 24"><path d="M22 2L11 13L2 9L4 20L22 2Z M22 2L15 22L11 13L22 2Z"></path></svg>
â€                    <span>Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒ Ú©Ø±Ù† Ø¨ Ø±ÛÛŒØ§ ØªÛŒÙ„ÛŒÚ¯Ø±Ø§Ù…ÛŒ</span>
â€                </a>
â€            </div>
â€        </main>
â€    </div>

â€    <script>
â€    document.addEventListener('DOMContentLoaded', function() {
â€        // --- STATE VARIABLES ---
â€        let allTasks = []; let overallSubjects = []; let progressHistory = [];
â€        let viewDate = new Date(); let chartInstance = null; let timerIntervals = {};
â€        let currentUser = null;
        
â€        // --- ICONS ---
â€        const CHECK_ICON = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`;
â€        const EDIT_ICON = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 3a2.85 2.83 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5Z"/><path d="m15 5 4 4"/></svg>`;
â€        const DELETE_ICON = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>`;
â€        const PLAY_ICON = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>`;
â€        const PAUSE_ICON = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>`;
â€        const TROPHY_ICON = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M9 12H4a2 2 0 0 0-2 2v3c0 1.1.9 2 2 2h5"/><path d="M15 12h5a2 2 0 0 1 2 2v3c0 1.1-.9 2-2 2h-5"/><path d="M12 15V2.25A2.25 2.25 0 0 0 9.75 0h-3.5A2.25 2.25 0 0 0 4 2.25V15"/><path d="M12 15V2.25A2.25 2.25 0 0 1 14.25 0h3.5A2.25 2.25 0 0 1 20 2.25V15"/></svg>`;
â€        const USER_ICON = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`;
â€        const LOGOUT_ICON = `<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>`;

â€        // --- CONSTANTS ---
â€        const DAY_NAMES = ["Ø¦ÛÚ© Ø´Û•Ù…Ø¨ÛŒ", "Ø¯ÙˆÙˆØ´Û•Ù…Ø¨ÛŒ", "Ø³Û Ø´Û•Ù…Ø¨ÛŒ", "Ú†Ø§Ø±Ø´Û•Ù…Ø¨ÛŒ", "Ù¾ÛÙ†Ø¬ Ø´Û•Ù…Ø¨ÛŒ", "Ø¦Û•ÛŒÙ†ÛŒ", "Ø´Û•Ù…Ø¨ÛŒ"];

â€        // --- FIREBASE SETUP ---
â€        const firebaseConfig = {
â€            apiKey: "AIzaSyC1D4aXKVIQndRGSZnAa5A_4b42VN8MX6s",
â€			  authDomain: "mala-jalil.firebaseapp.com",
â€			  projectId: "mala-jalil",
â€			  storageBucket: "mala-jalil.firebasestorage.app",
â€			  messagingSenderId: "934631314678",
â€			  appId: "1:934631314678:web:839ae0bda0a193eca408d7",
â€			  measurementId: "G-PZ9D19KX7B"
        };
        
â€        firebase.initializeApp(firebaseConfig);
â€        const auth = firebase.auth();
â€        const db = firebase.firestore();

â€        // --- AUTH & UI FUNCTIONS ---
â€        function showLoader() { document.getElementById('loader').classList.remove('hidden'); document.getElementById('loader').style.opacity = '1'; }
â€        function hideLoader() { document.getElementById('loader').style.opacity = '0'; setTimeout(() => document.getElementById('loader').classList.add('hidden'), 300); }

â€        function setupAuthListeners() {
â€            auth.onAuthStateChanged(user => {
â€                Object.values(timerIntervals).forEach(clearInterval);
â€                timerIntervals = {};

â€                if (user) {
â€                    currentUser = user;
â€                    document.getElementById('user-profile-btn').innerHTML = LOGOUT_ICON;
â€                    document.getElementById('user-profile-btn').title = "Ø¯Û•Ø±Ú©Û•ÙØªÙ†";
â€                    loadStateFromFirestore();
â€                } else {
â€                    currentUser = null;
â€                    document.getElementById('user-profile-btn').innerHTML = USER_ICON;
â€                    document.getElementById('user-profile-btn').title = "Ø¯Ø§Ø®Ù„Ø¨ÙˆÙˆÙ†";
â€                    loadStateFromLocalStorage();
                }
            });
        }
        
â€        function handleAuthFormSubmit(e) {
â€            e.preventDefault();
â€            const email = document.getElementById('auth-email').value;
â€            const password = document.getElementById('auth-password').value;
â€            const isSignUp = document.getElementById('auth-title').textContent.includes("Ù†ÙˆÙˆ");
â€            const errorP = document.getElementById('auth-error');
â€            errorP.textContent = '';

â€            const action = isSignUp 
â€                ? auth.createUserWithEmailAndPassword(email, password)
â€                : auth.signInWithEmailAndPassword(email, password);
            
â€            action
â€                .then(() => {
â€                    document.getElementById('auth-modal').classList.add('hidden');
â€                    document.getElementById('auth-form').reset();
                })
â€                .catch(() => { 
â€                    errorP.textContent = "Ø¦ÛŒÙ…ÛÙ„ ÛŒØ§Ù† Ú˜Ù…Ø§Ø±Ø§ Ù†Ù‡ÛÙ†ÛŒ ÛŒØ§ Ø¯Ø±ÙˆØ³Øª Ù†ÛŒÙ†Û•.";
                });
        }

â€        function signOutUser() {
â€            auth.signOut().catch(error => console.error("Sign out error", error));
        }

â€        // --- STORAGE FUNCTIONS ---
â€        function saveData() {
â€            if (currentUser) {
â€                saveStateToFirestore();
â€            } else {
â€                saveStateToLocalStorage();
            }
        }

â€        let saveTimeout;
â€        function saveStateToFirestore() {
â€            if (!currentUser) return;
            
â€            const tasksToSave = allTasks.map(t => ({ ...t, isTimerRunning: false }));

â€            clearTimeout(saveTimeout);
â€            saveTimeout = setTimeout(async () => {
â€                const dataToSave = {
â€                    allTasks: tasksToSave,
â€                    overallSubjects,
â€                    progressHistory,
â€                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                };
â€                try {
â€                    await db.collection('userSchedules').doc(currentUser.uid).set(dataToSave, { merge: true });
â€                } catch (error) {
â€                    console.error("Error saving data to Firestore: ", error);
                }
            }, 1500);
        }

â€        async function loadStateFromFirestore() {
â€            if (!currentUser) return;
â€            showLoader();
â€            const docRef = db.collection('userSchedules').doc(currentUser.uid);
â€            try {
â€                const doc = await docRef.get();
â€                if (doc.exists) {
â€                    const data = doc.data();
â€                    allTasks = data.allTasks || [];
â€                    allTasks.forEach(t => { t.elapsedTime = t.elapsedTime || 0; t.isTimerRunning = false; });
â€                    overallSubjects = data.overallSubjects || [];
â€                    progressHistory = data.progressHistory || [];
â€                } else {
â€                    allTasks = []; overallSubjects = []; progressHistory = [];
                }
â€            } catch (error) {
â€                console.error("Error loading data from Firestore: ", error);
â€                allTasks = []; overallSubjects = []; progressHistory = [];
            }
â€            renderAll();
â€            hideLoader();
        }

â€        function saveStateToLocalStorage() {
â€            try {
â€                const tasksToSave = allTasks.map(t => ({ ...t, isTimerRunning: false }));
â€                localStorage.setItem('studySchedule_srs_local', JSON.stringify({ allTasks: tasksToSave, overallSubjects, progressHistory }));
â€            } catch (e) {
â€                console.error("Error saving to localStorage", e);
            }
        }

â€        function loadStateFromLocalStorage() {
â€            const savedState = JSON.parse(localStorage.getItem('studySchedule_srs_local'));
â€            if (savedState) {
â€                allTasks = savedState.allTasks || [];
â€                allTasks.forEach(t => { t.elapsedTime = t.elapsedTime || 0; t.isTimerRunning = false; });
â€                overallSubjects = savedState.overallSubjects || [];
â€                progressHistory = savedState.progressHistory || [];
â€            } else {
â€                allTasks = []; overallSubjects = []; progressHistory = [];
            }
â€            renderAll();
        }

â€        // --- HELPER FUNCTIONS ---
â€        function toISODateString(date) { return new Date(date.getTime() - (date.getTimezoneOffset() * 60000)).toISOString().split('T')[0]; }
        
â€        function toNumericDateString(date) {
â€            const year = date.getFullYear();
â€            const month = (date.getMonth() + 1).toString().padStart(2, '0');
â€            const day = date.getDate().toString().padStart(2, '0');
â€            return `${year}/${month}/${day}`;
        }

â€        function formatTime(seconds) {
â€            const h = Math.floor(seconds / 3600).toString().padStart(2, '0');
â€            const m = Math.floor((seconds % 3600) / 60).toString().padStart(2, '0');
â€            const s = Math.floor(seconds % 60).toString().padStart(2, '0');
â€            return `${h}:${m}:${s}`;
        }

â€        function formatRemainingTime(days) {
â€            if (days < 0) return "(Ø¯Û•Ù… Ø¨Û†Ø±ÛŒÛ•)";
â€            if (days === 0) return "(Ø¯Û•Ù…Û ÙˆÛ Ø¦Û•Ú¤Ø±Û†ÛŒÛ•)";
            
â€            const months = Math.floor(days / 30);
â€            const weeks = Math.floor((days % 30) / 7);
â€            const remainingDays = days % 7;

â€            let parts = [];
â€            if (months > 0) parts.push(`${months} Ù‡Û•ÛŒÚ¤`);
â€            if (weeks > 0) parts.push(`${weeks} Ø­Û•ÙØªÛŒ`);
â€            if (remainingDays > 0) parts.push(`${remainingDays} Ø±Û†Ú˜`);

â€            return `(Ù…Ø§ÛŒÛ•: ${parts.join(' Ùˆ ')})`;
        }
        
â€        // --- RENDER FUNCTIONS ---
â€        function renderAll() {
â€            renderCurrentDayView();
â€            renderProgressAndAchievements();
â€            renderTimeReports();
â€            renderProgressChart();
        }

â€        function renderCurrentDayView() {
â€            const todayStr = toISODateString(viewDate);
â€            const dayOfWeek = DAY_NAMES[viewDate.getDay()];
â€            const tasksForToday = allTasks.filter(task => task.date === todayStr);
â€            const timeForThisDay = tasksForToday.reduce((sum, t) => sum + (t.elapsedTime || 0), 0);

â€            let tasksHtml;
â€            if (currentUser) {
â€                tasksHtml = tasksForToday.length > 0 ? tasksForToday.map(task => `
â€                    <tr>
â€                        <td>
â€                            <div class="task-container">
â€                                <input type="checkbox" id="task-${task.id}" data-task-id="${task.id}" ${task.isComplete ? 'checked' : ''}>
â€                                <label for="task-${task.id}">
â€                                    <span class="custom-checkbox">${CHECK_ICON}</span>
â€                                    <span class="task-subject">${task.bookName}</span>
â€                                </label>
â€                            </div>
â€                        </td>
â€                        <td class="task-description">${task.description}</td>
â€                        <td><span class="task-type-badge ${task.type}">${task.type === 'memorize' ? 'Ú˜Ø¨Û•Ø±Ú©Ø±Ù†' : 'Ù¾ÛØ¯Ø§Ú†ÙˆÙˆÙ†'}</span></td>
â€                        <td>
â€                            <div class="timer-controls">
â€                                <button class="timer-btn" data-task-id="${task.id}" title="Ø¯Û•Ø³ØªÙ¾ÛÚ©Ø±Ù†/Ø±Ø§ÙˆÛ•Ø³ØªØ§Ù†Ø¯Ù†">${task.isTimerRunning ? PAUSE_ICON : PLAY_ICON}</button>
â€                                <span class="timer-display" id="timer-${task.id}">${formatTime(task.elapsedTime || 0)}</span>
â€                            </div>
â€                        </td>
â€                    </tr>`).join('') : `<tr><td colspan="4" style="text-align:center; padding: 1.5rem;">Ù‡ÛŒÚ† Ú©Ø§Ø±Û•Ú© Ø¨Û† Ø¦Û•Ú¤Ø±Û† Ù†ÛŒÙ†Û•.</td></tr>`;
â€            } else {
â€                 tasksHtml = `<tr><td colspan="4" style="text-align:center; padding: 2.5rem;">Ø¨Û† Ø¯ÛŒØªÙ†Ø§ Ú©Ø§Ø±ÛÙ† Ø®Û† Ùˆ Ù¾Ø§Ø±Ø§Ø³ØªÙ†Ø§ Ù¾ÛØ´Ú©Û•ÙØªÙ†ÛØŒ ØªÚ©Ø§ÛŒÛ• Ø¯Ø§Ø®Ù„ Ø¨Ø¨Û•.</td></tr>`;
            }

â€            const completed = tasksForToday.filter(t => t.isComplete).length;
â€            const percentage = tasksForToday.length > 0 ? Math.round((completed / tasksForToday.length) * 100) : 0;
            
â€            document.getElementById('daily-schedule').innerHTML = `
â€                <div class="day-header">
â€                    <h2>${dayOfWeek}</h2>
â€                    <p>Ø¯Û•Ù…Ø§ Ø®ÙˆØ§Ù†Ø¯Ù†Ø§ Ú¤Û Ø±Û†Ú˜Û: ${formatTime(timeForThisDay)}</p>
â€                </div>
â€                <div class="progress-container">
â€                    <div class="progress-label">Ù¾ÛØ´Ú©Û•ÙØªÙ†Ø§ Ø¦Û•Ú¤Ø±Û†: ${completed}/${tasksForToday.length}</div>
â€                    <div class="progress"><div class="progress-bar ${percentage === 100 ? 'success' : ''}" style="width: ${percentage}%;"></div></div>
â€                </div>
â€                <table class="tasks-table"><tbody>${tasksHtml}</tbody></table>`;
â€            document.getElementById('current-date-display').textContent = toNumericDateString(viewDate);
        }
        
â€        function renderProgressAndAchievements() {
â€            const progressContainer = document.getElementById('overall-progress-container');
â€            const achievementsContainer = document.getElementById('achievements-container');
â€            const achievementsCard = document.getElementById('achievements-card');
            
â€            progressContainer.innerHTML = '';
â€            achievementsContainer.innerHTML = '';
â€            let completedCount = 0;

â€            if (!currentUser) {
â€                progressContainer.innerHTML = '<p style="text-align:center; width:100%;">Ø¨Û† Ø¯ÛŒØªÙ†Ø§ Ù¾ÛØ´Ú©Û•ÙØªÙ†Ø§ Ú¯Ø´ØªÛŒØŒ ØªÚ©Ø§ÛŒÛ• Ø¯Ø§Ø®Ù„ Ø¨Ø¨Û•.</p>';
â€                achievementsCard.classList.add('hidden');
â€                return;
            }

â€            overallSubjects.forEach(subject => {
â€                const percentage = subject.total > 0 ? Math.min(100, (subject.current / subject.total) * 100) : 0;
                
â€                const lastTask = allTasks.filter(t => t.bookId === subject.id && t.type === 'memorize').sort((a, b) => new Date(b.date) - new Date(a.date))[0];
â€                let completionHTML = '';
â€                if (lastTask) {
â€                    const completionDate = new Date(lastTask.date);
â€                    const today = new Date();
â€                    today.setHours(0,0,0,0);
â€                    const remainingDays = Math.ceil((completionDate - today) / (1000 * 60 * 60 * 24));
â€                    const completionDateStr = toNumericDateString(completionDate);
â€                    const completionMessage = formatRemainingTime(remainingDays);
                    
â€                    completionHTML = `<div class="subject-completion-info"><span>Ø±Û†Ú˜Ø§ ØªÙ…Ø§Ù…Ø¨ÙˆÙˆÙ†Û: ${completionDateStr} ${percentage < 100 ? completionMessage : '(ØªÙ…Ø§Ù… Ø¨ÙˆÙˆÛŒÛ•)'}</span></div>`;
                }

â€                if (percentage >= 100) {
â€                    completedCount++;
â€                    achievementsContainer.innerHTML += `<div class="achievement-item">${TROPHY_ICON}<span>${subject.name}</span></div>`;
â€                } else {
â€                    progressContainer.innerHTML += `
â€                        <div class="card subject-card">
â€                            <div class="subject-header">
â€                                <span class="subject-label">${subject.name}</span>
â€                                <div class="subject-controls">
â€                                    <button class="icon-btn edit edit-book-btn" data-book-id="${subject.id}" title="Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ">${EDIT_ICON}</button>
â€                                    <button class="icon-btn delete delete-book-btn" data-book-id="${subject.id}" title="Ú˜ÛØ¨Ø±Ù†">${DELETE_ICON}</button>
â€                                </div>
â€                            </div>
â€                            <div class="progress-inputs">
â€                                <span>ØªÙ…Ø§Ù… Ú©Ø±ÛŒÙ†Û•:</span>
â€                                <input type="number" class="subject-progress-current" data-book-id="${subject.id}" value="${subject.current}" min="0">
â€                                <span>Ú˜ Ú©Û†Ù…Ø§:</span><span>${subject.total}</span>
â€                            </div>
â€                            <div class="progress"><div class="progress-bar" style="width: ${percentage}%;"></div></div>
â€                            ${completionHTML}
â€                        </div>`;
                }
            });

â€            achievementsCard.classList.toggle('hidden', completedCount === 0);
        }
        
â€        function renderTimeReports() {
â€            const now = new Date();
â€            const todayStr = toISODateString(now);
â€            const dailySeconds = allTasks.filter(t => t.date === todayStr).reduce((sum, t) => sum + (t.elapsedTime || 0), 0);
            
â€            const startOfWeek = new Date(now);
â€            startOfWeek.setDate(startOfWeek.getDate() - now.getDay());
â€            const endOfWeek = new Date(startOfWeek);
â€            endOfWeek.setDate(endOfWeek.getDate() + 6);
â€            const weeklySeconds = allTasks.filter(t => t.date >= toISODateString(startOfWeek) && t.date <= toISODateString(endOfWeek))
â€                                     .reduce((sum, t) => sum + (t.elapsedTime || 0), 0);
            
â€            const startOfMonth = new Date(now.getFullYear(), now.getMonth(), 1);
â€            const endOfMonth = new Date(now.getFullYear(), now.getMonth() + 1, 0);
â€            const monthlySeconds = allTasks.filter(t => t.date >= toISODateString(startOfMonth) && t.date <= toISODateString(endOfMonth))
â€                                       .reduce((sum, t) => sum + (t.elapsedTime || 0), 0);

â€            document.getElementById('daily-time').textContent = formatTime(dailySeconds);
â€            document.getElementById('weekly-time').textContent = formatTime(weeklySeconds);
â€            document.getElementById('monthly-time').textContent = formatTime(monthlySeconds);
        }

â€        function renderProgressChart() { /* ... unchanged ... */ }
        
â€        // --- EVENT HANDLERS ---
â€        function setupEventListeners() {
â€            document.getElementById('add-book-form').addEventListener('submit', handleAddOrEditBook);
â€            document.body.addEventListener('click', handleBodyClick);
â€            document.body.addEventListener('change', handleBodyChange);
â€            document.body.addEventListener('input', handleBodyInput);
â€            document.getElementById('auth-form').addEventListener('submit', handleAuthFormSubmit);
        }

â€        function handleBodyClick(e) {
â€            const closest = selector => e.target.closest(selector);
â€            const target = closest('#theme-toggle, #next-day-btn, #prev-day-btn, #toggle-add-book-btn, .delete-book-btn, .edit-book-btn, .timer-btn, #user-profile-btn, #close-modal-btn, #switch-to-signup, #switch-to-login');
â€            if (!target) return;

â€            switch(target.id) {
â€                case 'theme-toggle':
â€                    document.body.classList.toggle('dark-mode');
â€                    localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
â€                    break;
â€                case 'next-day-btn':
â€                    viewDate.setDate(viewDate.getDate() + 1);
â€                    renderAll();
â€                    break;
â€                case 'prev-day-btn':
â€                    viewDate.setDate(viewDate.getDate() - 1);
â€                    renderAll();
â€                    break;
â€                case 'toggle-add-book-btn':
â€                    resetForm();
â€                    document.getElementById('add-book-section').classList.toggle('hidden');
â€                    break;
â€                case 'user-profile-btn':
â€                    if (currentUser) {
â€                        if (confirm("ØªÙˆ Ù¾Ø´ØªØ±Ø§Ø³ØªÛŒ Ø¯Ø®ÙˆØ§Ø²ÛŒ Ú˜ Ø­Ø³Ø§Ø¨Ø§ Ø®Û† Ø¯Û•Ø±Ú©Û•Ú¤ÛŒØŸ")) signOutUser();
â€                    } else {
â€                        document.getElementById('auth-modal').classList.remove('hidden');
                    }
â€                    break;
â€                case 'close-modal-btn':
â€                    e.preventDefault();
â€                    document.getElementById('auth-modal').classList.add('hidden');
â€                    break;
â€                case 'switch-to-signup':
â€                case 'switch-to-login':
â€                     e.preventDefault();
â€                     const isLogin = target.id === 'switch-to-login';
â€                     document.getElementById('auth-title').textContent = isLogin ? "Ø¯Ø§Ø®Ù„Ø¨ÙˆÙˆÙ†" : "Ø­Ø³Ø§Ø¨Û•Ú©Ø§ Ù†ÙˆÙˆ Ú†ÛÚ©Û•";
â€                     document.getElementById('auth-submit-btn').textContent = isLogin ? "Ø¯Ø§Ø®Ù„Ø¨ÙˆÙˆÙ†" : "Ú†ÛÚ©Ø±Ù†";
â€                     document.getElementById('auth-switch-p').innerHTML = isLogin 
                        ? `Ø­Ø³Ø§Ø¨Û ØªÛ• Ù†ÛŒÙ†Û•ØŸ <a href="#" id="switch-to-signup" style="color: var(--accent-color);">Ø¦ÛÚ©Û Ù†ÙˆÙˆ Ú†ÛÚ©Û•</a>`
                        : `Ø­Ø³Ø§Ø¨Û ØªÛ• Ù‡Û•ÛŒÛ•ØŸ <a href="#" id="switch-to-login" style="color: var(--accent-color);">Ø¯Ø§Ø®Ù„ Ø¨Ø¨Û•</a>`;
â€                     document.getElementById('auth-error').textContent = '';
â€                     break;
â€                default:
â€                    if (target.matches('.delete-book-btn')) deleteBook(target.dataset.bookId);
â€                    else if (target.matches('.edit-book-btn')) openEditForm(target.dataset.bookId);
â€                    else if (target.matches('.timer-btn')) toggleTimer(target.dataset.taskId);
            }
        }

â€        function handleBodyChange(e) {
â€            if (e.target.matches('input[type="checkbox"][data-task-id]')) {
â€                const task = allTasks.find(t => t.id == e.target.dataset.taskId);
â€                if (!task) return;
â€                task.isComplete = e.target.checked;
â€                const subject = overallSubjects.find(s => s.id === task.bookId);
â€                if (subject && task.type === 'memorize') { // Only update progress for memorization tasks
â€                    const unitValue = parseInt(task.units);
â€                    subject.current = Math.max(0, task.isComplete ? subject.current + unitValue : subject.current - unitValue);
                }
â€                renderAll(); saveData();
            }
        }
        
â€        function handleBodyInput(e) {
â€            if (e.target.matches('.subject-progress-current')) {
â€                const bookId = e.target.dataset.bookId;
â€                const subject = overallSubjects.find(s => s.id === bookId);
â€                if (subject) { subject.current = parseInt(e.target.value) || 0; renderAll(); saveData(); }
            }
        }
        
â€        function toggleTimer(taskId) {
â€            const task = allTasks.find(t => t.id == taskId);
â€            if (!task) return;

â€            task.isTimerRunning = !task.isTimerRunning;
            
â€            const timerBtn = document.querySelector(`.timer-btn[data-task-id='${taskId}']`);
â€            if (timerBtn) timerBtn.innerHTML = task.isTimerRunning ? PAUSE_ICON : PLAY_ICON;

â€            if (task.isTimerRunning) {
â€                timerIntervals[taskId] = setInterval(() => {
â€                    task.elapsedTime = (task.elapsedTime || 0) + 1;
â€                    document.getElementById(`timer-${taskId}`).textContent = formatTime(task.elapsedTime);

â€                    if (task.elapsedTime % 15 === 0) { saveData(); }
                }, 1000);
â€            } else {
â€                clearInterval(timerIntervals[taskId]);
â€                delete timerIntervals[taskId];
â€                renderTimeReports();
â€                saveData();
            }
        }
        
â€        // --- CORE LOGIC FUNCTIONS ---
â€        function handleAddOrEditBook(e) {
â€            e.preventDefault();
â€            const name = document.getElementById('new-book-name').value.trim();
â€            const total = parseInt(document.getElementById('new-book-total').value);
â€            const weeks = parseInt(document.getElementById('new-book-weeks').value);
â€            const memorizeDays = Array.from(document.querySelectorAll('#memorize-days input:checked')).map(cb => parseInt(cb.value));
â€            const reviewDays = Array.from(document.querySelectorAll('#review-days input:checked')).map(cb => parseInt(cb.value));
â€            const editingBookId = document.getElementById('editing-book-id').value;

â€            if (!name || isNaN(total) || total <= 0 || isNaN(weeks) || weeks <= 0 || memorizeDays.length === 0) {
â€                alert("ØªÚ©Ø§ÛŒÛ• Ù‡Û•Ù…ÛŒ Ø®Ø§Ù†Û•ÛŒØ§Ù† Ø¨ Ø¯Ø±ÙˆØ³ØªÛŒ Ù¾Ú• Ø¨Ú©Û• Ùˆ Ù„ Ú©ÛÙ… Ø±Û†Ú˜Û•Ú©Û Ø¨Û† Ú˜Ø¨Û•Ø±Ú©Ø±Ù†Û Ø¯Û•Ø³ØªÙ†ÛŒØ´Ø§Ù† Ø¨Ú©Û•."); return;
            }
            
â€            if (editingBookId) {
â€                allTasks = allTasks.filter(task => task.bookId !== editingBookId);
â€                overallSubjects = overallSubjects.filter(subject => subject.id !== editingBookId);
            }

â€            const bookId = editingBookId || name.replace(/[^a-zA-Z0-9]/g, '').toLowerCase() + Date.now();
            
â€            let tempDate = new Date();
â€            let totalSessions = 0;
â€            for (let i = 0; i < weeks * 7; i++) {
â€                if (memorizeDays.includes(tempDate.getDay())) {
â€                    totalSessions++;
                }
â€                tempDate.setDate(tempDate.getDate() + 1);
            }

â€            if (totalSessions === 0) { 
â€                alert("Ù‡ÛŒÚ† Ø±Û†Ú˜Û•Ú©Ø§ Ú˜Ø¨Û•Ø±Ú©Ø±Ù†Û Ø¯ Ù…Ø§ÙˆÛ Ø¯Û•Ø³ØªÙ†ÛŒØ´Ø§Ù†Ú©Ø±ÛŒ Ø¯Ø§ Ù†Û•Ù‡Ø§ØªÛ• Ø¯ÛŒØªÙ†!");
â€                return;
             }

â€            const basePagesPerSession = Math.floor(total / totalSessions);
â€            let extraPages = total % totalSessions;

â€            let currentDate = new Date();
â€            for (let i = 0; i < weeks * 7; i++) {
â€                // Add Memorization Task
â€                if (memorizeDays.includes(currentDate.getDay())) {
â€                    let pagesForThisSession = basePagesPerSession;
â€                    if (extraPages > 0) {
â€                        pagesForThisSession++;
â€                        extraPages--;
                    }
                    
â€                    if (pagesForThisSession > 0) {
â€                        allTasks.push({
â€                            id: Date.now() + i, bookId, bookName: name, date: toISODateString(currentDate),
â€                            type: 'memorize', description: `Ú˜Ø¨Û•Ø±Ú©Ø±Ù†Ø§ ${pagesForThisSession} Ù„Ø§Ù¾Û•Ø±`,
â€                            units: pagesForThisSession, isComplete: false, elapsedTime: 0, isTimerRunning: false
                        });
                    }
                }
                
â€                // Add Review Task
â€                if (reviewDays.includes(currentDate.getDay())) {
â€                     allTasks.push({
â€                        id: Date.now() + i + 500000, // Offset ID to avoid collision
â€                        bookId, bookName: name, date: toISODateString(currentDate),
â€                        type: 'review', description: `Ù¾ÛØ¯Ø§Ú†ÙˆÙˆÙ†Ø§ Ø¨Ø§Ø¨Û•ØªÛÙ† Ú¤Û Ø­Û•ÙØªÛŒÛ`,
â€                        units: 0, isComplete: false, elapsedTime: 0, isTimerRunning: false
                    });
                }

â€                currentDate.setDate(currentDate.getDate() + 1);
            }

â€            overallSubjects.push({ id: bookId, name, total, current: 0 });
â€            resetForm();
â€            document.getElementById('add-book-section').classList.add('hidden');
â€            renderAll(); saveData();
        }

â€        function deleteBook(bookId) {
â€            if (confirm("ØªÙˆ Ù¾Ø´ØªØ±Ø§Ø³ØªÛŒ Ø¯Ø®ÙˆØ§Ø²ÛŒ Ú¤ÛŒ Ø¨Ø§Ø¨Û•ØªÛŒ Ùˆ Ù‡Û•Ù…ÛŒ Ú©Ø§Ø±ÛÙ† Ù¾Û•ÛŒÙˆÛ•Ù†Ø¯ÛŒØ¯Ø§Ø± Ù¾ÛÚ¤Û• Ú˜Û Ø¨Ø¨Û•ÛŒØŸ")) {
â€                allTasks = allTasks.filter(task => task.bookId !== bookId);
â€                overallSubjects = overallSubjects.filter(subject => subject.id !== bookId);
â€                renderAll();
â€                saveData();
            }
        }
        
â€        function openEditForm(bookId) {
â€            const subject = overallSubjects.find(s => s.id === bookId);
â€            if (!subject) return;

â€            document.getElementById('form-title').textContent = "Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒÚ©Ø±Ù†Ø§ Ù¾Û•Ø±ØªÙˆÙˆÚ©Û";
â€            document.getElementById('add-book-btn').textContent = "Ú¯ÙˆÙ‡Ø§Ø±ØªÙ†Ø§Ù† Ø¨Ù¾Ø§Ø±ÛØ²Û•";
            
â€            document.getElementById('editing-book-id').value = subject.id;
â€            document.getElementById('new-book-name').value = subject.name;
â€            document.getElementById('new-book-total').value = subject.total;
â€            document.getElementById('new-book-weeks').value = ''; // User should re-enter weeks
            
â€            document.querySelectorAll('#memorize-days input:checked').forEach(cb => cb.checked = false);
â€            document.querySelectorAll('#review-days input:checked').forEach(cb => cb.checked = false);
â€            document.getElementById('add-book-section').classList.remove('hidden');
        }

â€        function resetForm() {
â€            document.getElementById('form-title').textContent = "Ù¾Û•Ø±ØªÙˆÙˆÚ©Û•Ú©Ø§ Ù†ÙˆÙˆ Ø²ÛØ¯Û• Ø¨Ú©Û•";
â€            document.getElementById('add-book-btn').textContent = "Ù¾Û•Ø±ØªÙˆÙˆÚ©Û Ø²ÛØ¯Û• Ø¨Ú©Û•";
â€            document.getElementById('add-book-form').reset();
â€            document.getElementById('editing-book-id').value = '';
        }
        
â€        // --- APP INITIALIZATION ---
â€        function initApp() {
â€            showLoader();
â€            if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode');
â€            const quotes = [{ text: "Ø²Ø§Ù†Ø³Øª Ù†ÙˆØ±Û•ØŒ Ùˆ Ù†ÙˆØ±Ø§ Ø®ÙˆØ¯Û Ù†Ø§Ø¯Ø±ÛØªÛ• Ú¯ÙˆÙ†Û•Ù‡Ú©Ø§Ø±Û•Ú©ÛŒ.", author: "Ø¦ÛŒÙ…Ø§Ù…Û Ø´Ø§ÙØ¹ÛŒ" }, { text: "ÛŒÛ Ú˜ Ø¨Û† Ø²Ø§Ù†Ø³ØªÛ Ø¯Û•Ø±Ú©Û•Ú¤ÛŒØªØŒ Ø¦Û•Ùˆ Ø¯ Ø±ÛÚ©Ø§ Ø®ÙˆØ¯Û Ø¯Ø§ÛŒÛ• Ø­Û•ØªØ§ Ø¨Ø²Ú¤Ø±ÛŒØª.", author: "Ù¾ÛØºÛ•Ù…Ø¨Û•Ø± Ù…Ø­Ù…Ø¯ (ï·º)" }, { text: "Ø³Û•Ø¨Ø± Ú©Ù„ÛŒÙ„Ø§ Ø³Û•Ø±Ú©Û•ÙØªÙ†Û ÛŒÛ•.", author: "Ú¯ÙˆØªÙ†Û•Ú©Ø§ Ø¨ Ù†Ø§Ú¤ Ùˆ Ø¯Û•Ù†Ú¯" }];
â€            const today = new Date(); const dayOfYear = Math.floor((today - new Date(today.getFullYear(), 0, 0)) / 864e5);
â€            const quote = quotes[dayOfYear % quotes.length];
â€            document.getElementById('quote-text').textContent = `"${quote.text}"`; document.getElementById('quote-author').textContent = `â€” ${quote.author}`;
            
â€            const memorizeContainer = document.getElementById('memorize-days');
â€            memorizeContainer.innerHTML = DAY_NAMES.map((day, index) => `<label><input type="checkbox" name="memorize" value="${index}"><span>${day}</span></label>`).join('');
            
â€            const reviewContainer = document.getElementById('review-days');
â€            reviewContainer.innerHTML = DAY_NAMES.map((day, index) => `<label><input type="checkbox" name="review" value="${index}"><span>${day}</span></label>`).join('');

â€            setupEventListeners();
â€            setupAuthListeners();
        }

â€        initApp();
    });
â€    </script>
â€</body>
â€</html>
